<!DOCTYPE html>
<html lang="pt-BR" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Prepara√ß√£o para Reda√ß√£o EAOAP</title>
    <!-- Chosen Palette: Slate & Amber -->
    <!-- Application Structure Plan: A single-page dashboard designed for strategic study. It begins with a summary of the exam's evaluation criteria presented as clear cards. The core is an interactive horizontal bar chart visualizing the probability of different thematic clusters. Clicking on a theme in the chart dynamically displays detailed analysis and sub-topics in a dedicated section below. The final section provides actionable study recommendations. A new section is added for an AI-powered argumentation point generator, allowing users to select a theme and receive generated arguments. A second AI-powered section is added to generate reflection questions, further aiding critical thinking. A responsive sidenav is introduced for mobile navigation, enhancing accessibility and user flow. All major sections now feature scroll-reveal animations for a smoother user experience. A new "Add Custom Theme" section allows users to dynamically add new study themes to the application's data by entering structured text (not raw HTML). A dark theme toggle is added to switch between light and dark modes, with full Tailwind dark mode support for all UI elements. -->
    <!-- Visualization & Content Choices: Report Info: Exam evaluation criteria -> Goal: Inform -> Viz/Method: Styled cards with icons (HTML/CSS) for quick scanning. Interaction: Hover effects, scroll-reveal. Report Info: Thematic probability matrix -> Goal: Compare & Guide -> Viz/Method: Interactive horizontal bar chart (Chart.js/Canvas) to visually rank themes. Interaction: Clicks on chart bars filter the detailed content view. Report Info: Detailed theme analysis -> Goal: Organize & Inform -> Viz/Method: Dynamically updated content blocks (JS-controlled divs). Interaction: Content is revealed based on chart selection, scroll-reveal. Report Info: Argumentation point generation -> Goal: Assist in content creation -> Viz/Method: Dropdown for theme selection, button to trigger LLM call, and a list to display generated points (HTML/CSS/JS). Interaction: User selects theme, clicks button, AI generates points, scroll-reveal. Report Info: Reflection question generation -> Goal: Stimulate critical thinking -> Viz/Method: Dropdown for theme selection, button to trigger LLM call, and a list to display generated questions (HTML/CSS/JS). Interaction: User selects theme, clicks button, AI generates questions, scroll-reveal. Report Info: Add Custom Theme -> Goal: Personalization & Ease of Use -> Viz/Method: Form with structured text input fields (HTML/CSS/JS) for subtheme titles and details. Interaction: User inputs text, submits form, JS constructs HTML, theme is added to data and UI. Report Info: Theme Toggle -> Goal: User Preference -> Viz/Method: Button (HTML/CSS/JS) to switch between light/dark modes. Interaction: User clicks button, UI and chart colors change. This design avoids static data presentation and promotes active exploration, content generation, critical engagement, and personalization with a user-friendly input system. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.3s ease-in-out, color 0.3s ease-in-out;
        }
        /* Default Light Mode */
        html {
            background-color: #f8fafc; /* slate-50 */
            color: #334155; /* slate-700 */
        }
        /* Dark Mode */
        html.dark {
            background-color: #1e293b; /* slate-800 */
            color: #e2e8f0; /* slate-200 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 320px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        /* Base for scroll-reveal animation */
        .content-fade {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.7s ease-out, transform 0.7s ease-out;
        }
        .content-fade.visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body class="text-slate-700 dark:text-slate-200">

    <!-- Header & Navigation -->
    <header class="bg-slate-800 text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <h1 class="text-xl md:text-2xl font-bold text-amber-400">An√°lise Estrat√©gica EAOAP</h1>
            <div class="flex items-center space-x-4">
                <!-- Dark Mode Toggle -->
                <button id="themeToggle" class="p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500 transition-colors" aria-label="Alternar tema">
                    <span id="themeIcon" class="text-2xl">‚òÄÔ∏è</span>
                </button>
                <!-- Mobile Hamburger -->
                <button id="menuButton" class="md:hidden p-2 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-500">
                    <div class="w-6 h-0.5 bg-white mb-1"></div>
                    <div class="w-6 h-0.5 bg-white mb-1"></div>
                    <div class="w-6 h-0.5 bg-white"></div>
                </button>
            </div>
            <nav class="hidden md:flex space-x-6 font-medium">
                <a href="#padroes" class="hover:text-amber-400 transition-colors">Padr√µes</a>
                <a href="#probabilidade" class="hover:text-amber-400 transition-colors">Probabilidade</a>
                <a href="#temas" class="hover:text-amber-400 transition-colors">Temas</a>
                <a href="#gerador-argumentos" class="hover:text-amber-400 transition-colors">Gerador ‚ú®</a>
                <a href="#gerador-perguntas" class="hover:text-amber-400 transition-colors">Perguntas üß†</a>
                <a href="#adicionar-tema" class="hover:text-amber-400 transition-colors">Adicionar Tema +</a>
                <a href="#recomendacoes" class="hover:text-amber-400 transition-colors">Recomenda√ß√µes</a>
            </nav>
        </div>
    </header>

    <!-- Sidenav Overlay -->
    <div id="sidenavOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden transition-opacity duration-300"></div>

    <!-- Sidenav -->
    <nav id="sidenav" class="fixed top-0 left-0 w-64 h-full bg-slate-900 text-white z-50 transform -translate-x-full transition-transform duration-300 ease-in-out md:hidden">
        <div class="p-6">
            <h2 class="text-2xl font-bold text-amber-400 mb-6">Menu</h2>
            <ul class="space-y-4">
                <li><a href="#padroes" class="block py-2 px-4 rounded hover:bg-slate-700 transition-colors sidenav-link">Padr√µes</a></li>
                <li><a href="#probabilidade" class="block py-2 px-4 rounded hover:bg-slate-700 transition-colors sidenav-link">Probabilidade</a></li>
                <li><a href="#temas" class="block py-2 px-4 rounded hover:bg-slate-700 transition-colors sidenav-link">Temas</a></li>
                <li><a href="#gerador-argumentos" class="block py-2 px-4 rounded hover:bg-slate-700 transition-colors sidenav-link">Gerador de Argumentos</a></li>
                <li><a href="#gerador-perguntas" class="block py-2 px-4 rounded hover:bg-slate-700 transition-colors sidenav-link">Gerador de Perguntas</a></li>
                <li><a href="#adicionar-tema" class="block py-2 px-4 rounded hover:bg-slate-700 transition-colors sidenav-link">Adicionar Tema</a></li>
                <li><a href="#recomendacoes" class="block py-2 px-4 rounded hover:bg-slate-700 transition-colors sidenav-link">Recomenda√ß√µes</a></li>
            </ul>
        </div>
    </nav>

    <main class="container mx-auto p-4 md:p-8">

        <!-- Introduction -->
        <section id="intro" class="text-center mb-16 content-fade">
            <h2 class="text-4xl font-extrabold text-slate-800 dark:text-slate-50 mb-4">Painel de Prepara√ß√£o para a Reda√ß√£o EAOAP</h2>
            <p class="max-w-3xl mx-auto text-lg text-slate-700 dark:text-slate-300">
                Esta √© uma ferramenta interativa projetada para otimizar seus estudos. Explore os crit√©rios de avalia√ß√£o, analise a probabilidade dos temas mais relevantes e aprofunde-se nas √°reas de interesse estrat√©gico da For√ßa A√©rea Brasileira (FAB) para alcan√ßar o sucesso na sua prova.
            </p>
        </section>

        <!-- Section 1: Exam Standards -->
        <section id="padroes" class="mb-16 content-fade">
            <h3 class="text-3xl font-bold text-slate-800 dark:text-slate-50 text-center mb-2">Padr√µes e Crit√©rios de Avalia√ß√£o</h3>
            <p class="text-center text-slate-700 dark:text-slate-300 mb-10 max-w-2xl mx-auto">A reda√ß√£o do EAOAP avalia sua capacidade de argumenta√ß√£o, profundidade de conhecimento e dom√≠nio da l√≠ngua portuguesa. Entenda os pilares da corre√ß√£o e suas penalidades para n√£o perder pontos cruciais.</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Expression Card -->
                <div class="bg-white dark:bg-slate-700 p-6 rounded-xl shadow-md border-t-4 border-slate-500 dark:border-slate-600 hover:shadow-xl transition-shadow">
                    <h4 class="text-xl font-bold text-slate-800 dark:text-slate-50 mb-2">Express√£o</h4>
                    <p class="text-slate-700 dark:text-slate-300 mb-4">Avalia a corre√ß√£o gramatical e clareza. Inclui pontua√ß√£o, ortografia, vocabul√°rio e morfossintaxe.</p>
                    <div class="text-2xl font-bold text-red-500 bg-red-100 dark:bg-red-900 dark:text-red-300 rounded-lg p-3 text-center">-0,2000 pts</div>
                    <p class="text-sm text-slate-600 dark:text-slate-400 mt-2 text-center">por cada erro cometido.</p>
                </div>
                <!-- Structure Card -->
                <div class="bg-white dark:bg-slate-700 p-6 rounded-xl shadow-md border-t-4 border-slate-500 dark:border-slate-600 hover:shadow-xl transition-shadow">
                    <h4 class="text-xl font-bold text-slate-800 dark:text-slate-50 mb-2">Estrutura</h4>
                    <p class="text-slate-700 dark:text-slate-300 mb-4">Foco na organiza√ß√£o l√≥gica do texto, principalmente a correta divis√£o em par√°grafos.</p>
                    <div class="text-2xl font-bold text-orange-500 bg-orange-100 dark:bg-orange-900 dark:text-orange-300 rounded-lg p-3 text-center">At√© -0,5000 pts</div>
                     <p class="text-sm text-slate-600 dark:text-slate-400 mt-2 text-center">por erro de paragrafa√ß√£o.</p>
                </div>
                <!-- Content Card -->
                <div class="bg-white dark:bg-slate-700 p-6 rounded-xl shadow-md border-t-4 border-slate-500 dark:border-slate-600 hover:shadow-xl transition-shadow">
                    <h4 class="text-xl font-bold text-slate-800 dark:text-slate-50 mb-2">Conte√∫do</h4>
                    <p class="text-slate-700 dark:text-slate-300 mb-4">O pilar mais importante. Avalia a pertin√™ncia ao tema, a qualidade da argumenta√ß√£o e a informatividade.</p>
                    <div class="text-2xl font-bold text-green-600 bg-green-100 dark:bg-green-900 dark:text-green-300 rounded-lg p-3 text-center">At√© -4,0000 pts</div>
                     <p class="text-sm text-slate-600 dark:text-slate-400 mt-2 text-center">no total dos tr√™s quesitos.</p>
                </div>
            </div>
        </section>

        <!-- Section 2: Thematic Probability Dashboard -->
        <section id="probabilidade" class="mb-16 bg-white dark:bg-slate-700 p-6 md:p-8 rounded-2xl shadow-lg content-fade">
            <h3 class="text-3xl font-bold text-slate-800 dark:text-slate-50 text-center mb-2">Matriz de Probabilidade dos Temas</h3>
            <p class="text-center text-slate-700 dark:text-slate-300 mb-8 max-w-3xl mx-auto">Com base nos √∫ltimos exames e no alinhamento estrat√©gico da FAB, este gr√°fico visualiza os clusters tem√°ticos com maior probabilidade de serem abordados. <strong class="text-amber-600">Clique em uma barra</strong> para explorar os detalhes do tema.</p>
            <div class="chart-container h-96 md:h-[450px]">
                <canvas id="temasChart"></canvas>
            </div>
        </section>

        <!-- Section 3: Detailed Theme Exploration -->
        <section id="temas" class="min-h-[500px] content-fade">
            <div id="tema-placeholder" class="text-center py-20">
                <h3 class="text-2xl font-bold text-slate-700 dark:text-slate-200 mb-4">Explore os Temas em Detalhe</h3>
                <p class="text-slate-600 dark:text-slate-400 text-lg max-w-xl mx-auto">Selecione um cluster tem√°tico no gr√°fico acima para ver a an√°lise aprofundada, subtemas relevantes e sua conex√£o com as prioridades da For√ßa A√©rea Brasileira.</p>
                 <div class="mt-8 text-6xl text-slate-300 dark:text-slate-500">‚úàÔ∏è</div>
            </div>
            <div id="tema-detalhes" class="hidden">
                 <h3 id="detalhe-titulo" class="text-3xl font-bold text-slate-800 dark:text-slate-50 text-center mb-10"></h3>
                 <div id="detalhe-conteudo" class="text-slate-700 dark:text-slate-300"></div>
            </div>
        </section>

        <!-- Section 4: Argumentation Points Generator -->
        <section id="gerador-argumentos" class="mt-16 pt-16 border-t border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 p-6 md:p-8 rounded-2xl shadow-lg content-fade">
            <h3 class="text-3xl font-bold text-slate-800 dark:text-slate-50 text-center mb-2">Gerador de Pontos de Argumenta√ß√£o ‚ú®</h3>
            <p class="text-center text-slate-700 dark:text-slate-300 mb-8 max-w-3xl mx-auto">Utilize a intelig√™ncia artificial para gerar pontos de argumenta√ß√£o concisos e relevantes para o tema que voc√™ est√° estudando. Uma ferramenta essencial para aprofundar seu repert√≥rio e estruturar suas ideias.</p>
            
            <div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4 mb-8">
                <label for="temaSelect" class="text-lg font-medium text-slate-700 dark:text-slate-200">Escolha um Tema:</label>
                <select id="temaSelect" class="p-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 text-slate-700 dark:bg-slate-800 dark:text-slate-200">
                    <!-- Options will be populated by JavaScript -->
                </select>
                <button id="gerarArgumentosBtn" class="bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-colors flex items-center justify-center space-x-2">
                    <span>Gerar Pontos de Argumenta√ß√£o ‚ú®</span>
                </button>
            </div>

            <div id="loadingSpinner" class="hidden text-center mt-6">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-slate-500 dark:border-slate-400 mx-auto"></div>
                <p class="text-slate-600 dark:text-slate-400 mt-2">Gerando ideias...</p>
            </div>

            <div id="errorContainer" class="text-red-500 text-center mt-4 hidden">
                Ocorreu um erro ao gerar os pontos de argumenta√ß√£o. Tente novamente mais tarde.
            </div>

            <div id="argumentosGerados" class="mt-8 bg-slate-50 dark:bg-slate-600 p-6 rounded-lg border border-slate-200 dark:border-slate-600 hidden">
                <h4 class="text-xl font-bold text-slate-800 dark:text-slate-50 mb-4 text-center">Pontos Gerados:</h4>
                <ul id="argumentosList" class="list-disc pl-5 space-y-2 text-slate-700 dark:text-slate-200">
                    <!-- Generated arguments will be displayed here -->
                </ul>
            </div>
        </section>

        <!-- Section 5: Reflection Questions Generator -->
        <section id="gerador-perguntas" class="mt-16 pt-16 border-t border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 p-6 md:p-8 rounded-2xl shadow-lg content-fade">
            <h3 class="text-3xl font-bold text-slate-800 dark:text-slate-50 text-center mb-2">Gerador de Perguntas para Reflex√£o üß†</h3>
            <p class="text-center text-slate-700 dark:text-slate-300 mb-8 max-w-3xl mx-auto">Estimule seu pensamento cr√≠tico gerando perguntas estrat√©gicas sobre os temas mais relevantes, ajudando a aprofundar sua an√°lise para a reda√ß√£o.</p>

            <div class="flex flex-col md:flex-row items-center justify-center space-y-4 md:space-y-0 md:space-x-4 mb-8">
                <label for="perguntaTemaSelect" class="text-lg font-medium text-slate-700 dark:text-slate-200">Escolha um Tema:</label>
                <select id="perguntaTemaSelect" class="p-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 text-slate-700 dark:bg-slate-800 dark:text-slate-200">
                    <!-- Options will be populated by JavaScript -->
                </select>
                <button id="gerarPerguntasBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-colors flex items-center justify-center space-x-2">
                    <span>Gerar Perguntas para Reflex√£o ü§î</span>
                </button>
            </div>

            <div id="loadingPerguntasSpinner" class="hidden text-center mt-6">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500 dark:border-blue-400 mx-auto"></div>
                <p class="text-slate-600 dark:text-slate-400 mt-2">Pensando em perguntas...</p>
            </div>

            <div id="errorPerguntasContainer" class="text-red-500 text-center mt-4 hidden">
                Ocorreu um erro ao gerar as perguntas. Tente novamente mais tarde.
            </div>

            <div id="perguntasGeradas" class="mt-8 bg-slate-50 dark:bg-slate-600 p-6 rounded-lg border border-slate-200 dark:border-slate-600 hidden">
                <h4 class="text-xl font-bold text-slate-800 dark:text-slate-50 mb-4 text-center">Perguntas Geradas:</h4>
                <ul id="perguntasList" class="list-disc pl-5 space-y-2 text-slate-700 dark:text-slate-200">
                    <!-- Generated questions will be displayed here -->
                </ul>
            </div>
        </section>

        <!-- Section 6: Add Custom Theme -->
        <section id="adicionar-tema" class="mt-16 pt-16 border-t border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 p-6 md:p-8 rounded-2xl shadow-lg content-fade">
            <h3 class="text-3xl font-bold text-slate-800 dark:text-slate-50 text-center mb-2">Adicionar Novo Tema de Estudo +</h3>
            <p class="text-center text-slate-700 dark:text-slate-300 mb-8 max-w-3xl mx-auto">Personalize seu painel! Adicione seus pr√≥prios temas de estudo para que eles apare√ßam no gr√°fico de probabilidade e nos geradores de IA, sem precisar de conhecimento em HTML.</p>
            
            <form id="addThemeForm" class="space-y-6 max-w-xl mx-auto">
                <div>
                    <label for="newThemeCluster" class="block text-lg font-medium text-slate-700 dark:text-slate-200 mb-2">Nome do Tema Principal:</label>
                    <input type="text" id="newThemeCluster" class="w-full p-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 text-slate-700 dark:bg-slate-800 dark:text-slate-200" placeholder="Ex: Criptografia Qu√¢ntica" required>
                </div>
                <div>
                    <label for="newThemeProb" class="block text-lg font-medium text-slate-700 dark:text-slate-200 mb-2">Probabilidade (0-100%):</label>
                    <input type="number" id="newThemeProb" class="w-full p-3 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-2 focus:ring-amber-500 text-slate-700 dark:bg-slate-800 dark:text-slate-200" min="0" max="100" placeholder="Ex: 70" required>
                </div>

                <div class="space-y-4 p-4 border border-slate-200 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-800">
                    <p class="text-lg font-medium text-slate-700 dark:text-slate-200">Subtemas e Detalhes (Opcional, at√© 3):</p>
                    <!-- Subtema 1 -->
                    <div>
                        <label for="newSubtheme1Title" class="block text-base font-medium text-slate-700 dark:text-slate-200 mb-1">T√≠tulo do Subtema 1:</label>
                        <input type="text" id="newSubtheme1Title" class="w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-1 focus:ring-amber-500 text-slate-700 dark:bg-slate-900 dark:text-slate-200" placeholder="Ex: Impacto Social da IA">
                        
                        <label for="newSubtheme1Details" class="block text-base font-medium text-slate-700 dark:text-slate-200 mt-3 mb-1">Detalhes do Subtema 1:</label>
                        <textarea id="newSubtheme1Details" class="w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-1 focus:ring-amber-500 text-slate-700 dark:bg-slate-900 dark:text-slate-200 h-20" placeholder="Aprofunde aqui os detalhes deste subtema."></textarea>
                    </div>

                    <!-- Subtema 2 -->
                    <div>
                        <label for="newSubtheme2Title" class="block text-base font-medium text-slate-700 dark:text-slate-200 mb-1">T√≠tulo do Subtema 2:</label>
                        <input type="text" id="newSubtheme2Title" class="w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-1 focus:ring-amber-500 text-slate-700 dark:bg-slate-900 dark:text-slate-200" placeholder="Ex: Aspectos √âticos e Legais">
                        
                        <label for="newSubtheme2Details" class="block text-base font-medium text-slate-700 dark:text-slate-200 mt-3 mb-1">Detalhes do Subtema 2:</label>
                        <textarea id="newSubtheme2Details" class="w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-1 focus:ring-amber-500 text-slate-700 dark:bg-slate-900 dark:text-slate-200 h-20" placeholder="Aprofunde aqui os detalhes deste subtema."></textarea>
                    </div>

                    <!-- Subtema 3 -->
                    <div>
                        <label for="newSubtheme3Title" class="block text-base font-medium text-slate-700 dark:text-slate-200 mb-1">T√≠tulo do Subtema 3:</label>
                        <input type="text" id="newSubtheme3Title" class="w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-1 focus:ring-amber-500 text-slate-700 dark:bg-slate-900 dark:text-slate-200" placeholder="Ex: Desafios Tecnol√≥gicos e de Implanta√ß√£o">
                        
                        <label for="newSubtheme3Details" class="block text-base font-medium text-slate-700 dark:text-slate-200 mt-3 mb-1">Detalhes do Subtema 3:</label>
                        <textarea id="newSubtheme3Details" class="w-full p-2 border border-slate-300 dark:border-slate-600 rounded-lg focus:outline-none focus:ring-1 focus:ring-amber-500 text-slate-700 dark:bg-slate-900 dark:text-slate-200 h-20" placeholder="Aprofunde aqui os detalhes deste subtema."></textarea>
                    </div>
                </div>

                <button type="submit" id="addThemeBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg shadow-lg transition-colors flex items-center justify-center space-x-2">
                    <span>Adicionar Tema Personalizado</span>
                </button>
                <div id="addThemeMessage" class="text-center mt-4 hidden"></div>
            </form>
        </section>


        <!-- Section 7: Strategic Recommendations -->
        <section id="recomendacoes" class="mt-16 pt-16 border-t border-slate-200 dark:border-slate-600 content-fade">
            <h3 class="text-3xl font-bold text-slate-800 dark:text-slate-50 text-center mb-2">Recomenda√ß√µes Estrat√©gicas</h3>
            <p class="text-center text-slate-700 dark:text-slate-300 mb-10 max-w-2xl mx-auto">Siga estes passos para construir uma prepara√ß√£o s√≥lida e assertiva, focando no que realmente importa para a prova de reda√ß√£o do EAOAP.</p>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="bg-white dark:bg-slate-700 p-6 rounded-xl shadow-md border-t-4 border-amber-500 hover:shadow-xl transition-shadow dark:border-slate-600">
                    <h4 class="text-xl font-bold text-slate-800 dark:text-slate-50 mb-2">Aprofunde-se nas Atualidades</h4>
                    <p class="text-slate-700 dark:text-slate-300">V√° al√©m das manchetes. Consulte fontes oficiais da FAB e do Minist√©rio da Defesa. Entenda os projetos estrat√©gicos (VLM-1, Programa SIRIUS) e o contexto geopol√≠tico que os envolvem.</p>
                </div>
                <div class="bg-white dark:bg-slate-700 p-6 rounded-xl shadow-md border-t-4 border-amber-500 hover:shadow-xl transition-shadow dark:border-slate-600">
                    <h4 class="text-xl font-bold text-slate-800 dark:text-slate-50 mb-2">Desenvolva sua Argumenta√ß√£o</h4>
                    <p class="text-slate-700 dark:text-slate-300">Para cada tema, colete dados e exemplos concretos. Pratique a estrutura√ß√£o de argumentos l√≥gicos. Use as informa√ß√µes deste painel para criar um repert√≥rio informativo e relevante para a prova.</p>
                </div>
                <div class="bg-white dark:bg-slate-700 p-6 rounded-xl shadow-md border-t-4 border-amber-500 hover:shadow-xl transition-shadow dark:border-slate-600">
                    <h4 class="text-xl font-bold text-slate-800 dark:text-slate-50 mb-2">Pratique e Revise com Rigor</h4>
                    <p class="text-slate-700 dark:text-slate-300">Redija textos sob condi√ß√µes de tempo simuladas. Pe√ßa feedback e, principalmente, revise sua pr√≥pria escrita com foco nos crit√©rios de "Express√£o". Cada erro evitado √© um passo mais perto da aprova√ß√£o.</p>
                </div>
            </div>
        </section>
    </main>

    <footer class="bg-slate-800 text-white mt-16">
        <div class="container mx-auto p-6 text-center text-slate-400">
            <p>&copy; 2025 Painel de Prepara√ß√£o Estrat√©gica. Ferramenta de apoio ao candidato EAOAP.</p>
        </div>
    </footer>

    <script>
        const appData = {
            temas: [
                {
                    cluster: 'Intelig√™ncia Artificial (IA)',
                    probabilidade: 95,
                    probabilidade_label: 'Alta',
                    cor: 'rgba(59, 130, 246, 0.7)',
                    corBorda: 'rgba(59, 130, 246, 1)',
                    conteudo: `
                        <div class="space-y-6">
                            <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">IA na Tomada de Decis√£o e Opera√ß√µes</h5>
                                <p class="text-slate-700 dark:text-slate-300">O Brasil busca uma "IA Soberana", essencial para a autonomia e seguran√ßa. Para a FAB, isso significa sistemas de intelig√™ncia, vigil√¢ncia e reconhecimento (ISR) seguros e n√£o vulner√°veis a controles externos, impactando diretamente a soberania nacional.</p>
                            </div>
                            <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">Desafios √âticos e Regulat√≥rios</h5>
                                <p class="text-slate-700 dark:text-slate-300">A integra√ß√£o da IA na defesa levanta debates sobre armas aut√¥nomas (LAWS), diretrizes √©ticas em conflitos e a seguran√ßa contra ciberataques. A reda√ß√£o pode exigir uma an√°lise desses marcos regulat√≥rios e dilemas morais.</p>
                            </div>
                            <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">Futuro do Trabalho e Forma√ß√£o na FAB</h5>
                                <p class="text-slate-700 dark:text-slate-300">A IA redefinir√° fun√ß√µes, exigindo novas habilidades. O tema pode explorar como a FAB prepara seu capital humano para este futuro, focando em aprendizagem cont√≠nua, adaptabilidade e qualidades humanas insubstitu√≠veis, como lideran√ßa e intui√ß√£o estrat√©gica.</p>
                            </div>
                        </div>
                    `
                },
                {
                    cluster: 'Ciberseguran√ßa',
                    probabilidade: 90,
                    probabilidade_label: 'Alta',
                    cor: 'rgba(239, 68, 68, 0.7)',
                    corBorda: 'rgba(239, 68, 68, 1)',
                    conteudo: `
                         <div class="space-y-6">
                            <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">Amea√ßas e Resili√™ncia de Infraestruturas</h5>
                                <p class="text-slate-700 dark:text-slate-300">A intensa atividade do Centro de Defesa Cibern√©tica da Aeron√°utica (CDCAER) e a participa√ß√£o em exerc√≠cios como CRUZEX CYBER e Locked Shields (OTAN) mostram que a ciberseguran√ßa √© uma prioridade m√°xima, garantindo a continuidade das opera√ß√µes a√©reas e de comando.</p>
                            </div>
                            <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">Ciberdefesa na Guerra Moderna</h5>
                                <p class="text-slate-700 dark:text-slate-300">A integra√ß√£o de opera√ß√µes cibern√©ticas em grandes exerc√≠cios a√©reos revela uma mudan√ßa de doutrina: a guerra cibern√©tica √© parte intr√≠nseca das opera√ß√µes a√©reas. O tema pode abordar opera√ß√µes multidom√≠nio e a fus√£o entre o conflito f√≠sico e digital.</p>
                            </div>
                            <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">A Fronteira Qu√¢ntica</h5>
                                <p class="text-slate-700 dark:text-slate-300">A men√ß√£o a "tecnologias qu√¢nticas" como a pr√≥xima fronteira para criptografia demonstra uma vis√£o de futuro. A reda√ß√£o pode explorar as implica√ß√µes da computa√ß√£o qu√¢ntica para a seguran√ßa nacional e a necessidade de investimento em pesquisa avan√ßada.</p>
                            </div>
                        </div>
                    `
                },
                {
                    cluster: 'Desenvolvimento Espacial',
                    probabilidade: 85,
                    probabilidade_label: 'Alta',
                    cor: 'rgba(245, 158, 11, 0.7)',
                    corBorda: 'rgba(245, 158, 11, 1)',
                    conteudo: `
                         <div class="space-y-6">
                            <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">Avan√ßos no Programa Espacial Brasileiro</h5>
                                <p class="text-slate-700 dark:text-slate-300">A "Opera√ß√£o Potiguar", com o lan√ßamento do foguete VS30, e o desenvolvimento do VLM-1, representam o impulso do Brasil por autonomia e competitividade no mercado espacial global. O tema pode focar na soberania nacional no espa√ßo e nos benef√≠cios estrat√©gicos de um programa independente.</p>
                            </div>
                            <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">Aplica√ß√µes em Defesa e Monitoramento</h5>
                                <p class="text-slate-700 dark:text-slate-300">A tecnologia espacial √© vital para intelig√™ncia, vigil√¢ncia e reconhecimento (ISR). O tema pode explorar como o Brasil usa suas capacidades para controle de fronteiras, prote√ß√£o da Amaz√¥nia e gerenciamento de desastres, tudo com implica√ß√µes diretas na defesa.</p>
                            </div>
                            <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">Brasil no Cen√°rio Aeroespacial Global</h5>
                                <p class="text-slate-700 dark:text-slate-300">A ambi√ß√£o de competir no mercado global levanta quest√µes sobre coopera√ß√£o internacional, parcerias tecnol√≥gicas e os desafios de se estabelecer em um dom√≠nio altamente competitivo. A reda√ß√£o pode abordar as implica√ß√µes geopol√≠ticas do poder espacial.</p>
                            </div>
                        </div>
                    `
                },
                {
                    cluster: 'Tecnologias Emergentes',
                    probabilidade: 75,
                    probabilidade_label: 'M√©dia-Alta',
                    cor: 'rgba(16, 185, 129, 0.7)',
                    corBorda: 'rgba(16, 185, 129, 1)',
                    conteudo: `
                         <div class="space-y-6">
                            <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">Tecnologias Qu√¢nticas</h5>
                                <p class="text-slate-700 dark:text-slate-300">O investimento proativo das For√ßas Armadas em tecnologias qu√¢nticas (para criptografia e computa√ß√£o) sinaliza uma vis√£o de longo prazo. O tema pode explorar o potencial disruptivo, a necessidade de ado√ß√£o precoce e os desafios de desenvolver tais capacidades no Brasil.</p>
                            </div>
                             <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">Ve√≠culos Hipers√¥nicos</h5>
                                <p class="text-slate-700 dark:text-slate-300">O desenvolvimento de aeronaves hipers√¥nicas pela FAB representa uma mudan√ßa de paradigma no poder a√©reo. A reda√ß√£o pode discutir as vantagens estrat√©gicas (velocidade, dissuas√£o) e como essa tecnologia pode remodelar o combate a√©reo e as estrat√©gias de defesa.</p>
                            </div>
                            <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">Autonomia Tecnol√≥gica e Soberania</h5>
                                <p class="text-slate-700 dark:text-slate-300">A colabora√ß√£o entre For√ßas Armadas, academia e ind√∫stria √© vista como fundamental para desenvolver "tecnologias cr√≠ticas" e manter a "soberania nacional". O tema pode focar na import√¢ncia da P&D dom√©stica e na redu√ß√£o da depend√™ncia de fornecedores estrangeiros.</p>
                            </div>
                        </div>
                    `
                },
                {
                    cluster: 'Sustentabilidade e Meio Ambiente',
                    probabilidade: 60,
                    probabilidade_label: 'M√©dia',
                    cor: 'rgba(139, 92, 246, 0.7)',
                    corBorda: 'rgba(139, 92, 246, 1)',
                    conteudo: `
                         <div class="space-y-6">
                            <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">Prote√ß√£o Ambiental como Miss√£o</h5>
                                <p class="text-slate-700 dark:text-slate-300">A doutrina da FAB inclui "defender, preservar e recuperar o meio ambiente". A atua√ß√£o na Amaz√¥nia e programas como o SIRIUS (redu√ß√£o de emiss√µes) mostram que a prote√ß√£o ambiental est√° integrada √† miss√£o operacional e √† defesa da soberania.</p>
                            </div>
                            <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">Efici√™ncia Energ√©tica e Energias Renov√°veis</h5>
                                <p class="text-slate-700 dark:text-slate-300">O uso de energia solar em destacamentos e a ado√ß√£o de pr√°ticas sustent√°veis em novas constru√ß√µes demonstram um ganho estrat√©gico. O tema pode abordar seguran√ßa energ√©tica, redu√ß√£o de custos e de encargos log√≠sticos como vantagens para a prontid√£o militar.</p>
                            </div>
                            <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">Desafios Clim√°ticos e Seguran√ßa</h5>
                                 <p class="text-slate-700 dark:text-slate-300">As mudan√ßas clim√°ticas, impactando recursos como √°gua e alimentos, s√£o cada vez mais vistas como amea√ßas √† seguran√ßa nacional. A reda√ß√£o pode explorar o conceito de "seguran√ßa clim√°tica" e o papel das For√ßas Armadas na mitiga√ß√£o de seus impactos.</p>
                            </div>
                        </div>
                    `
                },
            ]
        };

        let myChart; // Vari√°vel global para a inst√¢ncia do Chart.js

        document.addEventListener('DOMContentLoaded', () => {
            const ctx = document.getElementById('temasChart').getContext('2d');
            
            myChart = new Chart(ctx, { // Atribui √† vari√°vel global
                type: 'bar',
                data: {
                    labels: appData.temas.map(t => t.cluster),
                    datasets: [{
                        label: 'Probabilidade Qualitativa',
                        data: appData.temas.map(t => t.probabilidade),
                        backgroundColor: appData.temas.map(t => t.cor),
                        borderColor: appData.temas.map(t => t.corBorda),
                        borderWidth: 2,
                        borderRadius: 5,
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.parsed.x !== null) {
                                        const tema = appData.temas[context.dataIndex];
                                        label += `${tema.probabilidade_label} (${context.parsed.x}%)`;
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                display: false,
                                drawBorder: false,
                            },
                             ticks: {
                                callback: function(value) {
                                    return value + '%';
                                },
                                font: {
                                    weight: 'bold'
                                },
                                color: (document.documentElement.classList.contains('dark') ? '#cbd5e1' : '#334155') 
                            }
                        },
                        y: {
                            grid: {
                                display: false,
                                drawBorder: false,
                            },
                            ticks: {
                                font: {
                                    size: 14,
                                    weight: '500'
                                },
                                color: (document.documentElement.classList.contains('dark') ? '#cbd5e1' : '#334155')
                            }
                        }
                    },
                    onClick: (event, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            const temaSelecionado = appData.temas[index];
                            displayTemaDetalhes(temaSelecionado);
                        }
                    },
                     onHover: (event, chartElement) => {
                        event.native.target.style.cursor = chartElement[0] ? 'pointer' : 'default';
                    }
                }
            });

            const placeholderDiv = document.getElementById('tema-placeholder');
            const detalhesDiv = document.getElementById('tema-detalhes');
            const tituloDetalhe = document.getElementById('detalhe-titulo');
            const conteudoDetalhe = document.getElementById('detalhe-conteudo');
            
            function displayTemaDetalhes(tema) {
                placeholderDiv.classList.add('hidden');
                
                detalhesDiv.classList.remove('visible');
                detalhesDiv.classList.remove('content-fade');

                setTimeout(() => {
                    tituloDetalhe.textContent = tema.cluster;
                    conteudoDetalhe.innerHTML = tema.conteudo;
                    detalhesDiv.classList.remove('hidden');
                    detalhesDiv.classList.add('content-fade');
                    
                    setTimeout(() => {
                        detalhesDiv.classList.add('visible');
                    }, 50);

                    detalhesDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100); 

            }

            // Sidenav logic
            const menuButton = document.getElementById('menuButton');
            const sidenav = document.getElementById('sidenav');
            const sidenavOverlay = document.getElementById('sidenavOverlay');
            const sidenavLinks = document.querySelectorAll('.sidenav-link');

            menuButton.addEventListener('click', () => {
                sidenav.classList.toggle('-translate-x-full');
                sidenavOverlay.classList.toggle('hidden');
            });

            sidenavOverlay.addEventListener('click', () => {
                sidenav.classList.add('-translate-x-full');
                sidenavOverlay.classList.add('hidden');
            });

            sidenavLinks.forEach(link => {
                link.addEventListener('click', (event) => {
                    event.preventDefault();
                    const targetId = link.getAttribute('href');
                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        targetElement.scrollIntoView({ behavior: 'smooth' });
                        sidenav.classList.add('-translate-x-full');
                        sidenavOverlay.classList.add('hidden');
                    }
                });
            });

            // Scroll Reveal Animation with Intersection Observer
            const sections = document.querySelectorAll('section');

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    } else {
                        // Optional: remove visible class when out of view if you want re-trigger on scroll back
                        // entry.target.classList.remove('visible');
                    }
                });
            }, {
                threshold: 0.1 // Trigger when 10% of the section is visible
            });

            sections.forEach(section => {
                // Ensure the initial state is hidden for the animation
                section.classList.add('content-fade');
                observer.observe(section);
            });

            // Dark Mode Toggle Logic
            const themeToggle = document.getElementById('themeToggle');
            const themeIcon = document.getElementById('themeIcon');
            const htmlElement = document.documentElement;

            // Apply theme on load
            if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                htmlElement.classList.add('dark');
                themeIcon.textContent = 'üåô';
            } else {
                htmlElement.classList.remove('dark');
                localStorage.theme = 'light'; // Ensure light mode is set if no preference or explicitly light
                themeIcon.textContent = '‚òÄÔ∏è';
            }

            // Function to update chart colors based on theme
            function updateChartColors() {
                const isDark = htmlElement.classList.contains('dark');
                myChart.options.scales.x.ticks.color = isDark ? '#cbd5e1' : '#334155';
                myChart.options.scales.y.ticks.color = isDark ? '#cbd5e1' : '#334155';
                myChart.update();
            }

            themeToggle.addEventListener('click', () => {
                if (htmlElement.classList.contains('dark')) {
                    htmlElement.classList.remove('dark');
                    localStorage.theme = 'light';
                    themeIcon.textContent = '‚òÄÔ∏è';
                } else {
                    htmlElement.classList.add('dark');
                    localStorage.theme = 'dark';
                    themeIcon.textContent = 'üåô';
                }
                updateChartColors(); // Update chart colors immediately
            });
            updateChartColors(); // Initial chart color update on page load

            // Gemini API Integration - Argumentation Generator
            const temaSelect = document.getElementById('temaSelect');
            const gerarArgumentosBtn = document.getElementById('gerarArgumentosBtn');
            const loadingSpinner = document.getElementById('loadingSpinner');
            const errorContainer = document.getElementById('errorContainer');
            const argumentosGeradosDiv = document.getElementById('argumentosGerados');
            const argumentosList = document.getElementById('argumentosList');

            // Gemini API Integration - Reflection Questions Generator
            const perguntaTemaSelect = document.getElementById('perguntaTemaSelect'); 
            const gerarPerguntasBtn = document.getElementById('gerarPerguntasBtn');
            const loadingPerguntasSpinner = document.getElementById('loadingPerguntasSpinner');
            const errorPerguntasContainer = document.getElementById('errorPerguntasContainer');
            const perguntasGeradasDiv = document.getElementById('perguntasGeradas');
            const perguntasList = document.getElementById('perguntasList');

            // Function to populate theme dropdowns
            function populateThemeDropdowns() {
                temaSelect.innerHTML = '';
                perguntaTemaSelect.innerHTML = '';
                appData.temas.forEach(tema => {
                    const option = document.createElement('option');
                    option.value = tema.cluster;
                    option.textContent = tema.cluster;
                    temaSelect.appendChild(option);

                    const perguntaOption = option.cloneNode(true); 
                    perguntaTemaSelect.appendChild(perguntaOption);
                });
            }
            populateThemeDropdowns(); // Initial population

            gerarArgumentosBtn.addEventListener('click', async () => {
                const selectedTheme = temaSelect.value;
                if (!selectedTheme) {
                    errorContainer.textContent = 'Por favor, selecione um tema.';
                    errorContainer.classList.remove('hidden');
                    argumentosGeradosDiv.classList.add('hidden');
                    return;
                }

                loadingSpinner.classList.remove('hidden');
                errorContainer.classList.add('hidden');
                argumentosGeradosDiv.classList.add('hidden');
                argumentosList.innerHTML = ''; // Clear previous arguments

                const prompt = `Gere 5 pontos de argumenta√ß√£o concisos e relevantes para uma reda√ß√£o sobre "${selectedTheme} na For√ßa A√©rea Brasileira", considerando aspectos estrat√©gicos, desafios e oportunidades. Cada ponto deve ser uma frase ou par√°grafo curto.`;
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "ARRAY",
                            items: { "type": "STRING" }
                        }
                    }
                };

                const apiKey = "AIzaSyB7AyliYun2KKB2HA-Ui3M1gOFk7bLPyHM"; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const json = result.candidates[0].content.parts[0].text;
                        const parsedJson = JSON.parse(json);

                        if (Array.isArray(parsedJson)) {
                            parsedJson.forEach(arg => {
                                const li = document.createElement('li');
                                li.textContent = arg;
                                argumentosList.appendChild(li);
                            });
                            argumentosGeradosDiv.classList.remove('hidden');
                            argumentosGeradosDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        } else {
                            errorContainer.textContent = 'Formato de resposta inesperado da IA. Tente novamente.';
                            errorContainer.classList.remove('hidden');
                        }
                    } else {
                        errorContainer.textContent = 'N√£o foi poss√≠vel gerar os pontos de argumenta√ß√£o. Tente novamente.';
                        errorContainer.classList.remove('hidden');
                    }
                } catch (error) {
                    errorContainer.textContent = 'Erro de conex√£o com o servidor. Verifique sua rede e tente novamente.';
                    errorContainer.classList.remove('hidden');
                    console.error('Erro ao chamar a API Gemini:', error);
                } finally {
                    loadingSpinner.classList.add('hidden');
                }
            });

            // Gemini API Integration - Reflection Questions Generator
            gerarPerguntasBtn.addEventListener('click', async () => {
                const selectedTheme = perguntaTemaSelect.value;
                if (!selectedTheme) {
                    errorPerguntasContainer.textContent = 'Por favor, selecione um tema.';
                    errorPerguntasContainer.classList.remove('hidden');
                    perguntasGeradasDiv.classList.add('hidden');
                    return;
                }

                loadingPerguntasSpinner.classList.remove('hidden');
                errorPerguntasContainer.classList.add('hidden');
                perguntasGeradasDiv.classList.add('hidden');
                perguntasList.innerHTML = ''; // Clear previous questions

                const prompt = `Gere 5 perguntas para reflex√£o sobre o tema "${selectedTheme} na For√ßa A√©rea Brasileira", que estimulem o pensamento cr√≠tico e aprofundem a an√°lise estrat√©gica. Cada pergunta deve ser concisa.`;
                let chatHistory = [];
                chatHistory.push({ role: "user", parts: [{ text: prompt }] });

                const payload = {
                    contents: chatHistory,
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "ARRAY",
                            items: { "type": "STRING" }
                        }
                    }
                };

                const apiKey = "AIzaSyB7AyliYun2KKB2HA-Ui3M1gOFk7bLPyHM"; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const json = result.candidates[0].content.parts[0].text;
                        const parsedJson = JSON.parse(json);

                        if (Array.isArray(parsedJson)) {
                            parsedJson.forEach(q => {
                                const li = document.createElement('li');
                                li.textContent = q;
                                perguntasList.appendChild(li);
                            });
                            perguntasGeradasDiv.classList.remove('hidden');
                            perguntasGeradasDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        } else {
                            errorPerguntasContainer.textContent = 'Formato de resposta inesperado da IA. Tente novamente.';
                            errorPerguntasContainer.classList.remove('hidden');
                        }
                    } else {
                        errorPerguntasContainer.textContent = 'N√£o foi poss√≠vel gerar as perguntas. Tente novamente.';
                        errorPerguntasContainer.classList.remove('hidden');
                    }
                } catch (error) {
                    errorPerguntasContainer.textContent = 'Erro de conex√£o com o servidor. Verifique sua rede e tente novamente.';
                    errorPerguntasContainer.classList.remove('hidden');
                    console.error('Erro ao chamar a API Gemini:', error);
                } finally {
                    loadingPerguntasSpinner.classList.add('hidden');
                }
            });

            // Add Custom Theme Logic
            const addThemeForm = document.getElementById('addThemeForm');
            const newThemeClusterInput = document.getElementById('newThemeCluster');
            const newThemeProbInput = document.getElementById('newThemeProb');
            const newSubtheme1TitleInput = document.getElementById('newSubtheme1Title');
            const newSubtheme1DetailsInput = document.getElementById('newSubtheme1Details');
            const newSubtheme2TitleInput = document.getElementById('newSubtheme2Title');
            const newSubtheme2DetailsInput = document.getElementById('newSubtheme2Details');
            const newSubtheme3TitleInput = document.getElementById('newSubtheme3Title');
            const newSubtheme3DetailsInput = document.getElementById('newSubtheme3Details');
            const addThemeMessage = document.getElementById('addThemeMessage');

            addThemeForm.addEventListener('submit', (event) => {
                event.preventDefault();

                const newCluster = newThemeClusterInput.value.trim();
                const newProb = parseInt(newThemeProbInput.value, 10);

                if (!newCluster || isNaN(newProb) || newProb < 0 || newProb > 100) {
                    addThemeMessage.classList.remove('hidden');
                    addThemeMessage.className = 'text-center mt-4 text-red-600';
                    addThemeMessage.textContent = 'Por favor, preencha o Nome do Tema e a Probabilidade corretamente (entre 0 e 100).';
                    return;
                }

                // Check for duplicate theme name
                if (appData.temas.some(tema => tema.cluster.toLowerCase() === newCluster.toLowerCase())) {
                    addThemeMessage.classList.remove('hidden');
                    addThemeMessage.className = 'text-center mt-4 text-orange-600';
                    addThemeMessage.textContent = `O tema "${newCluster}" j√° existe.`;
                    return;
                }

                let newContentHtml = '<div class="space-y-6">';

                const subthemes = [
                    { title: newSubtheme1TitleInput.value.trim(), details: newSubtheme1DetailsInput.value.trim() },
                    { title: newSubtheme2TitleInput.value.trim(), details: newSubtheme2DetailsInput.value.trim() },
                    { title: newSubtheme3TitleInput.value.trim(), details: newSubtheme3DetailsInput.value.trim() }
                ];

                let hasContent = false;
                subthemes.forEach(st => {
                    if (st.title && st.details) {
                        newContentHtml += `
                            <div>
                                <h5 class="font-bold text-lg mb-2 text-slate-700 dark:text-slate-200">${st.title}</h5>
                                <p class="text-slate-700 dark:text-slate-300">${st.details}</p>
                            </div>
                        `;
                        hasContent = true;
                    }
                });
                newContentHtml += '</div>';

                if (!hasContent) {
                    addThemeMessage.classList.remove('hidden');
                    addThemeMessage.className = 'text-center mt-4 text-orange-600';
                    addThemeMessage.textContent = 'Por favor, adicione pelo menos um subtema com t√≠tulo e detalhes para o novo tema.';
                    return;
                }


                const newTheme = {
                    cluster: newCluster,
                    probabilidade: newProb,
                    probabilidade_label: newProb >= 80 ? 'Alta' : (newProb >= 50 ? 'M√©dia' : 'Baixa'),
                    cor: `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 0.7)`, // Random color
                    corBorda: `rgba(${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, ${Math.floor(Math.random() * 255)}, 1)`, // Random color
                    conteudo: newContentHtml
                };

                appData.temas.push(newTheme);
                appData.temas.sort((a, b) => b.probabilidade - a.probabilidade); // Sort by probability

                // Update Chart
                myChart.data.labels = appData.temas.map(t => t.cluster);
                myChart.data.datasets[0].data = appData.temas.map(t => t.probabilidade);
                myChart.data.datasets[0].backgroundColor = appData.temas.map(t => t.cor);
                myChart.data.datasets[0].borderColor = appData.temas.map(t => t.corBorda);
                myChart.update();

                // Update dropdowns
                populateThemeDropdowns();

                // Store updated data in localStorage (optional, but good for persistence)
                localStorage.setItem('customThemes', JSON.stringify(appData.temas.filter(t => !t.hasOwnProperty('original')))); // Only store custom ones if original data is hardcoded

                addThemeMessage.classList.remove('hidden');
                addThemeMessage.className = 'text-center mt-4 text-green-600';
                addThemeMessage.textContent = `Tema "${newCluster}" adicionado com sucesso!`;

                // Clear form
                newThemeClusterInput.value = '';
                newThemeProbInput.value = '';
                newSubtheme1TitleInput.value = '';
                newSubtheme1DetailsInput.value = '';
                newSubtheme2TitleInput.value = '';
                newSubtheme2DetailsInput.value = '';
                newSubtheme3TitleInput.value = '';
                newSubtheme3DetailsInput.value = '';
            });

            // Load custom themes from localStorage on initial load
            const storedThemes = localStorage.getItem('customThemes');
            if (storedThemes) {
                try {
                    const parsedThemes = JSON.parse(storedThemes);
                    parsedThemes.forEach(theme => {
                        // Ensure original data doesn't get duplicated if theme was originally hardcoded
                        if (!appData.temas.some(t => t.cluster === theme.cluster)) {
                             appData.temas.push(theme);
                        }
                    });
                    appData.temas.sort((a, b) => b.probabilidade - a.probabilidade);
                    myChart.data.labels = appData.temas.map(t => t.cluster);
                    myChart.data.datasets[0].data = appData.temas.map(t => t.probabilidade);
                    myChart.data.datasets[0].backgroundColor = appData.temas.map(t => t.cor);
                    myChart.data.datasets[0].borderColor = appData.temas.map(t => t.corBorda);
                    myChart.update();
                    populateThemeDropdowns();
                } catch (e) {
                    console.error("Erro ao carregar temas do localStorage:", e);
                    localStorage.removeItem('customThemes'); // Clear corrupt data
                }
            }
        });
    </script>
</body>
</html>
